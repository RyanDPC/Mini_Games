<div id="popup-content">
    <button id="close-popup" class="close-btn"><i class="fas fa-times"></i></button>
    <h2 class="popup-title">Sign Up</h2>
    <form id="signup-form">
        <div class="form-group">
            <i class="fas fa-user"></i>
            <input type="text" placeholder="Username" id="signup-username" required>
        </div>
        <div class="form-group">
            <i class="fas fa-envelope"></i>
            <input type="email" placeholder="Email" id="signup-email" required>
        </div>
        <div class="form-group">
            <i class="fas fa-lock"></i>
            <input type="password" placeholder="Password" id="signup-password" required>
        </div>
        <div class="form-group">
            <i class="fas fa-lock"></i>
            <input type="password" placeholder="Confirm Password" id="signup-confirm-password" required>
        </div>
        <button type="submit" class="btn-signup">SIGN UP</button>
        <button type="button" class="login" id="login">Login</button>
    </form>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Gestion de la transition vers la fenêtre de connexion
        document.getElementById('login').addEventListener('click', () => {
            fetch('login.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors du chargement de login.html');
                    }
                    return response.text();
                })
                .then(content => {
                    document.getElementById('popup-container').innerHTML = content;
                })
                .catch(error => {
                    console.error('Erreur lors du chargement de login.html:', error);
                });
        });

        // Gestion de la soumission du formulaire d'inscription
        document.getElementById('signup-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const username = document.getElementById('signup-username').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value.trim();
            const confirmPassword = document.getElementById('signup-confirm-password').value.trim();

            // Validation des champs
            if (!username || !email || !password || !confirmPassword) {
                alert('Tous les champs sont requis.');
                return;
            }

            if (password !== confirmPassword) {
                alert('Les mots de passe ne correspondent pas.');
                return;
            }

            // Envoyer les données au serveur
            fetch('http://localhost:4000/api/users/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, email, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    alert('Inscription réussie ! Vous pouvez maintenant vous connecter.');
                    // Charger la page de connexion après une inscription réussie
                    fetch('login.html')
                        .then(response => response.text())
                        .then(content => {
                            document.getElementById('popup-container').innerHTML = content;
                        });
                }
            })
            .catch(error => {
                console.error('Erreur lors de l\'inscription:', error);
                alert('Une erreur est survenue lors de l\'inscription. Veuillez réessayer plus tard.');
            });
        });
    });
</script>
