<div id="popup-content">
    <button id="close-popup" class="close-btn"><i class="fas fa-times"></i></button>
    <h2 class="popup-title">Member Login</h2>
    <form id="login-form">
        <div class="form-group">
            <i class="fas fa-user"></i>
            <input type="text" placeholder="Username" id="username" required>
        </div>
        <div class="form-group">
            <i class="fas fa-lock"></i>
            <input type="password" placeholder="Password" id="password" required>
        </div>
        <div class="popup-links">
            <a href="#" class="forgot-password">Forgot Password? Click Here</a>
        </div>
        <button type="submit" class="btn-login">LOGIN</button>
        <button type="button" class="signup" id="signup">Sign Up</button>
    </form>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Gestion de l'inscription (bouton Sign Up)
        document.getElementById('signup').addEventListener('click', () => {
            fetch('signup.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors du chargement de la page d\'inscription.');
                    }
                    return response.text();
                })
                .then(content => {
                    document.getElementById('popup-container').innerHTML = content;
                })
                .catch(error => {
                    console.error('Erreur lors du chargement de signup.html:', error);
                });
        });

        // Gestion de la soumission du formulaire de connexion
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!username || !password) {
                alert('Veuillez remplir tous les champs.');
                return;
            }

            // Envoyer les données au serveur
            fetch('http://localhost:4000/api/users/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        alert('Connexion réussie !');
                        // Fermer le popup et afficher les infos utilisateur
                        document.getElementById('popup-container').style.display = 'none';
                        document.getElementById('overlay').style.display = 'none';
                        displayUserInfo(data.user);
                    }
                })
                .catch(err => {
                    console.error('Erreur lors de la connexion:', err);
                    alert('Une erreur est survenue lors de la connexion.');
                });
        });

        // Fonction pour afficher les informations utilisateur après la connexion
        function displayUserInfo(user) {
            const userSection = document.getElementById('user-section');
            userSection.innerHTML = `
                <div class="user-info">
                    <img src="${user.profilePicture || 'https://via.placeholder.com/50'}" alt="${user.username}" class="user-avatar">
                    <span class="user-name">${user.username}</span>
                    <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>
            `;

            // Gérer la déconnexion
            document.getElementById('logout-btn').addEventListener('click', () => {
                fetch('http://localhost:4000/api/users/logout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(() => {
                    userSection.innerHTML = `
                        <button id="login-btn">
                            <i class="fas fa-user-circle"></i>
                        </button>
                    `;
                    document.getElementById('login-btn').addEventListener('click', () => {
                        fetch('login.html')
                            .then(response => response.text())
                            .then(content => {
                                document.getElementById('popup-container').innerHTML = content;
                                document.getElementById('popup-container').style.display = 'block';
                                document.getElementById('overlay').style.display = 'block';
                            });
                    });
                })
                .catch(err => {
                    console.error('Erreur lors de la déconnexion:', err);
                    alert('Impossible de se déconnecter pour le moment.');
                });
            });
        }
    });
</script>
